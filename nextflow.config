import groovy.json.JsonSlurper
def JsonSlurper = new JsonSlurper()
azure_config = JsonSlurper.parse(new File("./credentials.json"))

params {
  /* Input, genomes, databases and output parameters */
  reads = 'az://masldmice/data/*_EKDN24000116{3,4}-1A_222VF7LT4_L{4,5}_{1,2}.fq.gz'
  host_genome = 'az://masldmice/host_genome/GCF_000001635.27_GRCm39_genomic.fna'
  genomedir = "az://masldmice/host_genome"
  multiqc = "$projectDir/multiqc"
  outdir = 'az://masldmice/results'
  metaphlan_db = "az://masldmice/databases/metaphlan_db"
  eggnog_db = "az://masldmice/databases/eggnog_db"

  /* Kneaddata parameters */
  //bypass-trim = false
  trimmomatic_options = "ILLUMINACLIP:TruSeq3-PE-2.fa:2:30:10 SLIDINGWINDOW:4:20 MINLEN:100"
  //sequencer-source = "NexteraPE"  // Available sequencers: ["NexteraPE","TruSeq2","TruSeq3"]
}

profiles {
  az_test {

    docker.enabled = true
    dag.overwrite = true

    process {
      executor = 'azurebatch'
    }

    azure {
      storage {
        accountName = azure_config["storageAccountName"]
        accountKey = azure_config["storageAccountKey"]
      }
      batch {
        location = 'westeurope'
        accountName = azure_config["batchAccountName"]
        accountKey = azure_config["batchAccountKey"]
        autoPoolMode = true
        allowPoolCreation = true
        pools {
          auto {
              autoScale = true
              vmType = 'Standard_D8_v3'
              maxVmCount = 10
          }
        }
      }
    }
  }

  local {
    docker.enabled = true
    dag.overwrite = true
  }
}